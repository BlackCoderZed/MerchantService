@model MerchantService.Models.mUser

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
<script>
    $(document).ready(function () {
        $('#browsestaff').click(function () {
            var w = window.open("/Staff/ChooseStaff", "popupWindow", "width=800, height=400, scrollbars=yes");
            //var $w = $(w.document.body);
            //$w.html("<textarea></textarea>");
        });

        $('#check').click(function () {

            var httpreq = new XMLHttpRequest();
            httpreq.onreadystatechange = function () {
                if(this.readyState==4 && this.status==200)
                {
                    var res_data = this.responseText;
                    if(res_data=="True")
                    {
                        $("#UserID").prop("readonly", true);
                        $('#Create').prop("disabled", false);
                        alert("User is Available");
                    }
                    else
                    {
                        alert("User is already taken");
                    }
                }
                else if(this.readyState==4 && this.status==404)
                {
                    alert("Check Function could not be called");
                }
            };
            httpreq.open("GET", "/User/Check?staffid=" + document.getElementById("StaffID").value + "&uid=" + document.getElementById("UserID").value, true);
            httpreq.send();
        });
    });

    function setStaffID(staffid,staffname,department,office)
    {
        document.getElementById('StaffID').value = staffid;
        document.getElementById('StaffName').value = staffname;
        document.getElementById('Department').value = department;
        document.getElementById('Office').value = office;
        //alert(staffid);
    }
</script>
<h5>Create User</h5>

<div class="container-fluid">
    <div class="row">
        <div class="col s12 m12 l6">
            <div class="card">
                <div class="card-content">

                    @using (Html.BeginForm("Create", "User", FormMethod.Post, new { @id = "formInfo" }))
                    {
                        @Html.AntiForgeryToken()

                        <div class="form-horizontal">
                            <hr />
                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                            <div class="form-group">
                                @Html.LabelFor(model => model.StaffID, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-7">
                                    @Html.EditorFor(model => model.StaffID, new { htmlAttributes = new { @class = "form-control", @required = "true",@readonly="true" } })
                                    @Html.ValidationMessageFor(model => model.StaffID, "", new { @class = "text-danger" })
                                </div>
                                <div class="col-md-2">
                                    @*<button class="btn" id="browsestaff" onclick="browsestaff">Browse</button>*@
                                    <a id="browsestaff" class="btn">Browse</a>
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.StaffName, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.StaffName, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.StaffName, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.Department, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.Department, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Department, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.Office, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.Office, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.Office, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.UserID, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-7">
                                    @Html.EditorFor(model => model.UserID, new { htmlAttributes = new { @class = "form-control", @required = "true" } })
                                    @Html.ValidationMessageFor(model => model.UserID, "", new { @class = "text-danger" })
                                </div>
                                <div class="col-md-2">
                                    <a class="btn" id="check">Check</a>
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.Passwd, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.Passwd, new { htmlAttributes = new { @class = "form-control", @required = "true" } })
                                    @Html.ValidationMessageFor(model => model.Passwd, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.UserLevel, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.UserLevel, new { htmlAttributes = new { @class = "form-control", @required = "true" } })
                                    @Html.ValidationMessageFor(model => model.UserLevel, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.AdminLogin, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.AdminLogin, new { htmlAttributes = new { @class = "form-control" ,@required = "true" } })
                                    @Html.ValidationMessageFor(model => model.AdminLogin, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-offset-2 col-md-10">
                                    <input type="submit" value="Create" id="Create" class="btn btn-default right" disabled />
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="col s12 m12 l6">
            <p style="color:red;">*** User Level -> 1 for Merchant Information and Report , 2 for Calculation and Report , 4 for report only.</p>
        </div>
    </div>
    <div class="row">
        
    </div>
</div>


<div>
    @Html.ActionLink("Back to List", "Index")
</div>

@{ 
    if(TempData["StatusMessage"]!=null)
    {
        <script>
            alert(@Html.Raw(Json.Encode(TempData["StatusMessage"])));
        </script>
        TempData.Clear();
    }
}